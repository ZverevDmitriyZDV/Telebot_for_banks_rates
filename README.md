# Telebot THB to RUB convertor

Телебот-помощник для отслеживания курса валют

* <b> USD к RUB </b> через Тинькофф клиент (формирование курса с учетом брокерских котировок)
* <b >USD к THB </b >через клиента Bangkok bank (курс для внутренних клиентов банка)
* формирование курса <b>RUB к THB</b> для многоступенчатой стратегии обмена с учетом всех комиссий.

Реализация на Python3.8.

##Доступные команды внутри запущенного Telebot:
* `/info` - производит все запросы валютных пар, выдает информацию
  ```
   USD         : XX.XX
   USD ema     : XX.XX
   Update      : HH:MM  DD/MM/YYYY

   THB         : XX.XX    
   Update      : HH:MM  DD/MM/YYYY

   RUB / THB   : X.XX
   RUB / THB*  : X.XX
   ``` 
  данные записываются в память, для обновления требуется вручную обновить данные по котировкам
* `/reset` - производит сброс внутренних значенией котировок, если их срок жизни превысил 1 час 1 мин (обновление курсов)
* `/usd` - производит запрос курса USD к RUB и записывает в память
* `/thb` - производит запрос THB к USD и записывает в память
* `/%` -  производит запрос соотношения котировок обмена RUB к THB. возможно задать свое значение для коммерческой помощи друзьям
* `/ex` - запускает калькуулятор конверсии курса из RUB в THB и обратно

##Получение необходимых токенов
Для корректной работы необходимо иметь несколько токенов для работы с API запросами / клиентами.
Данные ключи возможно поместь в файл  .env при запуске с машины, или в настройках ключей безопасности в Heroku

####Требуемые ключи:
```
TELEBOT        =  ХХХХХХХХ
TOKEN_BANGKOK  =  ХХХХХХХХ
TOKEN_TINK     =  ХХХХХХХХ
URL_HEROKU     =  ХХХХХХХХ
```
### Детали получения ключей:

TELEBOT:
   
      В телеграмме написать личное сообщение @BotFather - /newbot
      Пройти все последующие этапы регистрации бота.
      В конце бот выдаст сообщение с Токеном  и ссылками на API методы
      
TOKEN_BANGKOK:
     
      ПО ссылке пройти регистрацию https://developer.bangkokbank.com/
      В разделе личного кабинета https://developer.bangkokbank.com/developer 
      найти токен для создания  API запросов Primary key
      
TOKEN_TINK:
     
      Перейдите в настройки профиля Тинькофф Инвестиции по ссылке: 
      https://www.tinkoff.ru/invest/settings/
      
URL_HEROKU:

      соответсвует url вашего новосозданного приложения на Heroku

   
##Heroku usage:
Приложение развертывается на сервере Heroku через Git репозиторий.

Стоит обратить внимание на `branch` проекта используемой репозитории перед деплоем

###Этапы запуска:
* `telebot_from_computer.py` отправить в gitignore.
* осуществить `git push` в требуемый репозиторий  
* Развернуть проект на `Heroku` через подключение `GIT репозитория`.
* в настройках `apps Heroku` создать требуемые ключи и предать им значения. Ключи повторяют названия ниже:
    - `TELEBOT        ХХХХХХХХ`
    - `TOKEN_BANGKOK  ХХХХХХХХ`
    - `TOKEN_TINK     ХХХХХХХХ`
    - `URL_HEROKU     ХХХХХХХХ`
* произвести deploy git репозитория в Heroku
* отправить запрос на webhook телеграмма `https://api.telegram.org/<TELEBOT>/setWebhook?url=<HEROKU_URL>`  
* после подтверждения запроса бот будет связан с HEROKU, дальнейшие ошибку будут связанны только с внутренним кодом.  
* наслаждаться работой телебота

##Использование с компьютере 
Запуск будет проивходить из файла``telebot_from_computer.py``

Рекомендуется использовать для подстроек и проверки API ключей, или в случае развертывания на ином ресурсе от Heroku

###Этапы запуска:
* создать .env файл.
* внести значения требуемых ключей
   ```
   TELEBOT        =  ХХХХХХХХ
   TOKEN_BANGKOK  =  ХХХХХХХХ
   TOKEN_TINK     =  ХХХХХХХХ
   ```
* произвести установку библиотек `pip install -r requirements.txt`
* произвести запуск `telebot_from_computer.py`
* пройти в окно чата с telebot-ом и проверить работоспособность
####ВАЖНО
>при таком методе не нужно создавать `webhoock`, еcли до этого был запущен `webhook с Heroku` его нужно силой удалить.
> URL_HEROKU создавать ненужно.



